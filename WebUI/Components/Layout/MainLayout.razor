@inherits LayoutComponentBase
@inject NavigationManager Nav
@inject ISnackbar Snackbar

<MudLayout>
    <MudThemeProvider />
    <MudPopoverProvider />
    <MudDialogProvider />
    <MudSnackbarProvider />

    <MudAppBar Elevation="1" Dense="true">
        <MudToolbar>
            <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" OnClick="@ToggleDrawer" Edge="Edge.Start" />
            <MudText Typo="Typo.h6" Class="ml-2">Snippet Manager</MudText>

            <MudSpacer />

            <MudTextField T="string" @bind-Value="_globalSearch" Placeholder="Search snippets..." Immediate="true" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" Class="mud-width-full mud-width-sm" OnImmediateValueChanged="OnGlobalSearch" />

            <MudIconButton Icon="@Icons.Material.Filled.AccountCircle" OnClick="@OnProfileClicked" Edge="Edge.End" Color="Color.Inherit" />

        </MudToolbar>
    </MudAppBar>

    <MudDrawer @bind-Open="_drawerOpen" Variant="DrawerVariant.Responsive" Elevation="2" Anchor="Anchor.Start" ClipMode="DrawerClipMode.Never" Class="mud-width-280">
        <MudNavMenu>
            <MudNavLink Href="/" Icon="@Icons.Material.Filled.Home">Home</MudNavLink>
            <MudNavLink Href="/snippets" Icon="@Icons.Material.Filled.Code">Snippets</MudNavLink>
            <MudNavLink Href="/snippets/mine" Icon="@Icons.Material.Filled.Person">My Snippets</MudNavLink>
            <MudNavLink Href="/tags" Icon="@Icons.Material.Filled.Label">Tags</MudNavLink>
            <MudNavLink Href="/about" Icon="@Icons.Material.Filled.Info">About</MudNavLink>
        </MudNavMenu>
    </MudDrawer>

    <MudMainContent Class="pa-6">
        <div class="mud-container">
            <div class="mud-grid">
                @Body
            </div>
        </div>
    </MudMainContent>
    <MudFab Icon="@Icons.Material.Filled.Add" Class="fab-add" OnClick="@(()=>Nav.NavigateTo("/snippets/new"))" />
</MudLayout>

@code {
    bool _drawerOpen = true;
    string? _globalSearch;

    void ToggleDrawer()
    {
        _drawerOpen = !_drawerOpen;
    }

    void OnProfileClicked()
    {
        Snackbar.Add("Profile / Auth not implemented (placeholder)", Severity.Info);
    }

    async Task OnGlobalSearch(string value)
    {
        // Broadcast a global search optionally with an EventCallback or state container.
        // Placeholder: navigate to main list with query param
        if (!string.IsNullOrWhiteSpace(value))
            Nav.NavigateTo($"/snippets?search={Uri.EscapeDataString(value)}");
        else
            Nav.NavigateTo($"/snippets");
    }
}
